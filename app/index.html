<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>vdotapes</title>
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; media-src 'self' blob:; connect-src 'self';"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="header">
      <div class="controls">
        <div class="brand-title">vdotapes</div>
        <button class="folder-btn compact" id="folderBtn">📁</button>
        <div class="status" id="status">No folder selected</div>

        <div class="filter-controls" id="filterControls">
          <!-- Quick filters group -->
          <div class="control-group">
            <button class="icon-btn favorites-btn" id="favoritesBtn" title="Show favorites only">
              <svg viewBox="0 0 24 24">
                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
              </svg>
              <span class="badge" id="favoritesCount">0</span>
            </button>
            <button class="icon-btn hidden-btn" id="hiddenBtn" title="Show hidden files only">
              <svg viewBox="0 0 24 24">
                <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
              </svg>
              <span class="badge" id="hiddenCount">0</span>
            </button>
          </div>

          <!-- Sort dropdown -->
          <div class="dropdown" id="sortDropdown">
            <button class="icon-btn dropdown-btn" id="sortBtn" title="Sort options">
              <svg viewBox="0 0 24 24">
                <path d="M3 18h6v-2H3v2zM3 6v2h18V6H3zm0 7h12v-2H3v2z"/>
              </svg>
            </button>
            <div class="dropdown-menu" id="sortMenu">
              <button id="sortFolderBtn" data-sort="folder">📁 By Folder</button>
              <button id="sortDateBtn" data-sort="date">📅 By Date</button>
              <button id="shuffleBtn">🔀 Shuffle</button>
            </div>
          </div>

          <!-- Tag search (compact) -->
          <div class="tag-search-compact" id="tagSearchContainer">
            <input type="text" id="tagSearchInput" placeholder="🏷️" autocomplete="off" />
            <button class="tag-mode-toggle" id="tagModeToggle" title="Toggle AND/OR mode">OR</button>
          </div>

          <!-- Tag cloud button -->
          <button class="icon-btn tag-cloud-btn" id="tagCloudBtn" title="Show tag cloud">
            <svg viewBox="0 0 24 24">
              <path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"/>
            </svg>
          </button>

          <!-- Folder select (compact) -->
          <select id="folderSelect" class="compact-select" title="Filter by folder">
            <option value="">All folders</option>
          </select>

          <!-- Settings dropdown -->
          <div class="dropdown" id="settingsDropdown">
            <button class="icon-btn dropdown-btn" id="settingsBtn" title="Settings">
              <svg viewBox="0 0 24 24">
                <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
              </svg>
            </button>
            <div class="dropdown-menu" id="settingsMenu">
              <button id="gridColsBtn">
                <span>Grid: </span>
                <span id="gridColsCount">4</span>
              </button>
              <button id="backupExport">💾 Export Backup</button>
              <button id="backupImport">📂 Import Backup</button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Tag filter status bar -->
      <div class="tag-status-bar" id="tagStatus" style="display: none;"></div>
    </div>

    <div class="container">
      <div class="progress-bar" id="progressBar">
        <div class="progress-fill" id="progressFill"></div>
      </div>

      <div id="content">
        <div class="empty-state">
          <h2>Welcome to VdoTapes</h2>
          <p>
            High-performance video viewer with Instagram-style browsing.<br />
            Select a folder containing your videos to get started.
          </p>
          <div style="margin-top: 2rem; color: #777; font-size: 0.85rem">
            📱 Responsive grid layout with customizable columns<br />
            🎬 Formats: MP4, WebM, OGG, MOV, AVI, WMV, FLV, MKV, M4V<br />
            ⚡ Videos preview automatically in grid view<br />
            📁 Filter by subfolder and sort your collection<br />
            🔀 Shuffle mode for random browsing<br />
            💾 Persistent favorites and settings
          </div>
        </div>
      </div>
    </div>

    <div class="expanded-overlay" id="expandedOverlay">
      <button class="close-btn" id="closeBtn">×</button>
      <video class="expanded-video" id="expandedVideo" loop></video>
      <aside class="expanded-sidebar" id="expandedSidebar">
        <div class="sidebar-section">
          <div class="sidebar-toolbar">
            <button id="sidebarFavoriteBtn" class="sidebar-btn icon-btn heart" title="Favorite">
              <svg viewBox="0 0 24 24" class="icon">
                <path
                  d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"
                />
              </svg>
            </button>
            <button id="sidebarHiddenBtn" class="sidebar-btn icon-btn eye" title="Hide">
              <svg viewBox="0 0 24 24" class="icon">
                <path
                  d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"
                />
              </svg>
            </button>
            <button id="goToFileBtn" class="sidebar-btn icon-btn folder" title="Show File">
              <svg viewBox="0 0 24 24" class="icon">
                <path
                  d="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"
                />
              </svg>
            </button>
          </div>
        </div>
        <div class="sidebar-section">
          <div class="section-title">Tags</div>
          <div class="tag-list" id="tagList"></div>
          <input type="text" id="tagInput" placeholder="Add tag and press Enter" />
        </div>
        <div class="sidebar-section">
          <div class="section-title">Details</div>
          <div class="meta-row">
            <span class="meta-key">Subfolder</span> <span id="metaFolder" class="meta-val"></span>
          </div>
          <div class="meta-row">
            <span class="meta-key">Length</span> <span id="metaLength" class="meta-val"></span>
          </div>
          <div class="meta-row">
            <span class="meta-key">Filename</span> <span id="metaFilename" class="meta-val"></span>
          </div>
        </div>
      </aside>
    </div>

    <div class="multi-view-overlay" id="multiViewOverlay">
      <button class="close-btn" id="multiViewCloseBtn">×</button>
      <div class="multi-view-container" id="multiViewContainer">
        <!-- Multi-view videos will be inserted here -->
      </div>
    </div>

    <div class="tag-cloud-overlay" id="tagCloudOverlay">
      <div class="tag-cloud-container">
        <button class="close-btn" id="tagCloudCloseBtn">×</button>
        <h2 class="tag-cloud-title">Tag Cloud</h2>
        <div class="tag-cloud-content" id="tagCloudContent">
          <!-- Tag cloud items rendered here -->
        </div>
        <div class="tag-cloud-footer">
          <span class="tag-cloud-info">Click any tag to filter videos</span>
        </div>
      </div>
    </div>

    <div class="context-menu" id="contextMenu">
      <ul>
        <li class="context-menu-item" data-action="open-location">
          <svg viewBox="0 0 24 24" class="context-menu-icon">
            <path
              d="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"
            />
          </svg>
          Show File
        </li>
        <li class="context-menu-item" data-action="toggle-favorite">
          <svg viewBox="0 0 24 24" class="context-menu-icon">
            <path
              d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"
            />
          </svg>
          <span class="favorite-text">Add to Favorites</span>
        </li>
        <li class="context-menu-item" data-action="toggle-hidden">
          <svg viewBox="0 0 24 24" class="context-menu-icon">
            <path
              d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"
            />
          </svg>
          <span class="hidden-text">Hide</span>
        </li>
        <li class="context-menu-item" data-action="add-to-multi-view">
          <svg viewBox="0 0 24 24" class="context-menu-icon">
            <path
              d="M16 16H2v2h14v-2zm-5-4H2v2h9v-2zm5 0h5v2h-5v-2zm0-4h5v2h-5v-2zM2 8h9v2H2V8zm0-4h14v2H2V4z"
            />
          </svg>
          Add to Multi-View
        </li>
      </ul>
    </div>

    <script src="video-smart-loader.js"></script>

    <!-- Load modular components -->
    <script src="modules/ThumbnailPreloader.js"></script>
    <script src="modules/VideoManager.js"></script>
    <script src="modules/VideoExpander.js"></script>
    <script src="modules/FilterManager.js"></script>
    <script src="modules/TagManager.js"></script>
    <script src="modules/TagCloudManager.js"></script>
    <script src="modules/GridRenderer.js"></script>
    <script src="modules/UserDataManager.js"></script>
    <script src="modules/UIHelper.js"></script>
    <script src="modules/EventController.js"></script>

    <!-- Main app coordinator -->
    <script src="renderer.js"></script>
  </body>
</html>
